# FPaCo Project Codebase

æœ¬é¡¹ç›®åŒ…å«äº† FPaCo è®ºæ–‡ç›¸å…³çš„å®éªŒä»£ç ï¼Œæ¶µç›–äº†å¤šç§åŸºäºè§†è§‰-è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰çš„é€‚é…æ–¹æ³•ã€é•¿å°¾åˆ†å¸ƒå­¦ä¹ æ–¹æ³•ä»¥åŠå¤šæ¨¡æ€èåˆç®—æ³•ã€‚

## ğŸ“‚ ç›®å½•ç»“æ„ä¸æ–¹æ³•ä»‹ç»

### 1. è§†è§‰-è¯­è¨€æ¨¡å‹é€‚é… (VLM Adaptation)
åˆ©ç”¨é¢„è®­ç»ƒçš„ BioMedCLIP æ¨¡å‹è¿›è¡Œé›¶æ ·æœ¬æ¨ç†æˆ–å¾®è°ƒé€‚é…ã€‚

- **`biomedclip/`**: **Zero-Shot Baseline (é›¶æ ·æœ¬åŸºå‡†)**
- **`tipadapter/`**: **Tip-Adapter (Training-free Adaptation)**
- **`coop/`**: **CoOp (Context Optimization)**
- **`tda/`**: **Test-Time Adaptation (æµ‹è¯•æ—¶é€‚é…)**
- **`dpe/`**: **Decomposed Prompt Ensemble (åˆ†è§£æç¤ºè¯é›†æˆ)**

### 2. é•¿å°¾åˆ†å¸ƒä¸ç›‘ç£å­¦ä¹ åŸºå‡† (Long-Tail & Supervised Baselines)
- **`paco/`**: **PaCo (Parametric Contrastive Learning)**
- **`gpaco/`**: **GPaCo (Generalized PaCo)**
- **`bpaco_original/`**: **B-PaCo (Balanced PaCo)**
- **`ce_loss/`**: **Cross Entropy Baseline**
- **`focal_loss/`**: **Focal Loss Baseline**

### 3. å¤šæ¨¡æ€ä¸é«˜çº§æ–¹æ³• (Multimodal & Advanced)
- **`multimodal_classification/`**: **Multimodal B-PaCo (å¤šæ¨¡æ€ B-PaCo)**

---

## ğŸš€ å®éªŒè¿è¡Œæ–¹æ³• (Run Experiments)

è¯·è¿›å…¥å¯¹åº”çš„æ–¹æ³•æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œç›¸åº”çš„ bash è„šæœ¬å³å¯å¼€å§‹å®éªŒã€‚

### 1. BioMedCLIP Zero-Shot
```bash
cd biomedclip
bash run_biomedclip_experiments.sh
```

### 2. Tip-Adapter
```bash
cd tipadapter
bash run_biomed_tipadapter.sh
```

### 3. CoOp
```bash
cd coop
bash run_coop_biomed.sh
```

### 4. Test-Time Adaptation (TDA)
```bash
cd tda
bash run_tda.sh
```

### 5. Decomposed Prompt Ensemble (DPE)
```bash
cd dpe
bash run_dpe_biomed.sh
```

### 6. PaCo (Parametric Contrastive Learning)
```bash
cd paco
bash run_paco_experiments.sh
```

### 7. GPaCo (Generalized PaCo)
```bash
cd gpaco
bash run_gpaco_experiments.sh
```

### 8. B-PaCo (Balanced PaCo - Original)
```bash
cd bpaco_original
bash run_bpaco_reproduced.sh
```

### 9. Multimodal B-PaCo Heatmap
```bash
cd multimodal_classification
# è‡ªåŠ¨è°ƒå‚è¿è¡Œ
bash run_heatmap_tuning.sh
# æˆ–å•æ¬¡è®­ç»ƒ
python train_bpaco_heatmap.py --dataset ...
```

---

## ğŸ”§ æç¤ºè¯ä¸æ•°æ®é›† (Prompts & Data)

- **`prompts/unified_prompts.json`**: åŒ…å«æ‰€æœ‰æ•°æ®é›†çš„ç»Ÿä¸€ã€é«˜è´¨é‡æç¤ºè¯ï¼ˆCuPL Styleï¼‰ã€‚
- **`datasets/`**: å­˜æ”¾æ•°æ®é›†æ–‡ä»¶ã€‚

è¯·ç¡®ä¿ç¯å¢ƒå·²å®‰è£…å¿…è¦çš„ä¾èµ–åº“ï¼Œå¹¶ä¸”æ•°æ®é›†è·¯å¾„é…ç½®æ­£ç¡®ï¼ˆé»˜è®¤ä¸º `../datasets`ï¼‰ã€‚

---

# Dataset Statistics
Generated by datasets/count_stats.py

## aptos_classification_dataset

- **Total Samples**: Train: 2933, Val: 364, Test: 365

- **Imbalance Ratio (Train)**: 15.37 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 1552 | 180 | 73 |
| class_1 | 260 | 37 | 73 |
| class_2 | 827 | 99 | 73 |
| class_3 | 101 | 19 | 73 |
| class_4 | 193 | 29 | 73 |

## fingerprint_classification_dataset

- **Total Samples**: Train: 1290, Val: 270, Test: 296

- **Imbalance Ratio (Train)**: 42.60 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 147 | 31 | 32 |
| class_1 | 213 | 45 | 48 |
| class_2 | 159 | 32 | 36 |
| class_3 | 115 | 24 | 26 |
| class_4 | 38 | 8 | 9 |
| class_5 | 46 | 10 | 11 |
| class_6 | 45 | 9 | 11 |
| class_7 | 98 | 22 | 21 |
| class_8 | 70 | 15 | 15 |
| class_9 | 103 | 22 | 24 |
| class_10 | 23 | 4 | 6 |
| class_11 | 95 | 21 | 21 |
| class_12 | 25 | 5 | 7 |
| class_13 | 21 | 5 | 6 |
| class_14 | 7 | 1 | 2 |
| class_15 | 23 | 4 | 6 |
| class_16 | 5 | 1 | 2 |
| class_17 | 23 | 4 | 5 |
| class_18 | 34 | 7 | 8 |

## mias_classification_dataset

- **Total Samples**: Train: 266, Val: 28, Test: 28

- **Imbalance Ratio (Train)**: 20.33 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 183 | 20 | 4 |
| class_1 | 19 | 2 | 4 |
| class_2 | 17 | 2 | 4 |
| class_3 | 14 | 1 | 4 |
| class_4 | 9 | 1 | 4 |
| class_5 | 14 | 1 | 4 |
| class_6 | 10 | 1 | 4 |

## oral_cancer_classification_dataset

- **Total Samples**: Train: 107, Val: 12, Test: 12

- **Imbalance Ratio (Train)**: 2.34 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 32 | 6 | 6 |
| class_1 | 75 | 6 | 6 |

## octa_classification_dataset

- **Total Samples**: Train: 404, Val: 47, Test: 49

- **Imbalance Ratio (Train)**: 109.50 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 219 | 25 | 7 |
| class_1 | 8 | 1 | 7 |
| class_2 | 51 | 6 | 7 |
| class_3 | 38 | 4 | 7 |
| class_4 | 80 | 9 | 7 |
| class_5 | 2 | 1 | 7 |
| class_6 | 6 | 1 | 7 |

## fingerA

- **Total Samples**: Train: 3337, Val: 390, Test: 468

- **Imbalance Ratio (Train)**: 30.00 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 8 | 0 | 26 |
| class_1 | 210 | 26 | 26 |
| class_2 | 210 | 26 | 26 |
| class_3 | 210 | 26 | 26 |
| class_4 | 210 | 26 | 26 |
| class_5 | 172 | 0 | 26 |
| class_6 | 210 | 26 | 26 |
| class_7 | 7 | 0 | 26 |
| class_8 | 210 | 26 | 26 |
| class_9 | 210 | 26 | 26 |
| class_10 | 210 | 26 | 26 |
| class_11 | 210 | 26 | 26 |
| class_12 | 210 | 26 | 26 |
| class_13 | 210 | 26 | 26 |
| class_14 | 210 | 26 | 26 |
| class_15 | 210 | 26 | 26 |
| class_16 | 210 | 26 | 26 |
| class_17 | 210 | 26 | 26 |

## fingerB

- **Total Samples**: Train: 2402, Val: 206, Test: 468

- **Imbalance Ratio (Train)**: 73.43 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 8 | 0 | 26 |
| class_1 | 258 | 0 | 26 |
| class_2 | 514 | 64 | 26 |
| class_3 | 268 | 0 | 26 |
| class_4 | 332 | 41 | 26 |
| class_5 | 172 | 0 | 26 |
| class_6 | 215 | 26 | 26 |
| class_7 | 7 | 0 | 26 |
| class_8 | 139 | 17 | 26 |
| class_9 | 112 | 14 | 26 |
| class_10 | 90 | 11 | 26 |
| class_11 | 72 | 9 | 26 |
| class_12 | 58 | 7 | 26 |
| class_13 | 47 | 5 | 26 |
| class_14 | 37 | 4 | 26 |
| class_15 | 30 | 3 | 26 |
| class_16 | 24 | 3 | 26 |
| class_17 | 19 | 2 | 26 |

## fingerC

- **Total Samples**: Train: 2256, Val: 187, Test: 468

- **Imbalance Ratio (Train)**: 77.86 (Max/Min)

- **Class Distribution**:

| Class | Train | Val | Test |
| :--- | :--- | :--- | :--- |
| class_0 | 8 | 0 | 26 |
| class_1 | 258 | 0 | 26 |
| class_2 | 545 | 68 | 26 |
| class_3 | 268 | 0 | 26 |
| class_4 | 327 | 40 | 26 |
| class_5 | 172 | 0 | 26 |
| class_6 | 196 | 24 | 26 |
| class_7 | 7 | 0 | 26 |
| class_8 | 117 | 14 | 26 |
| class_9 | 90 | 11 | 26 |
| class_10 | 70 | 8 | 26 |
| class_11 | 54 | 6 | 26 |
| class_12 | 42 | 5 | 26 |
| class_13 | 32 | 4 | 26 |
| class_14 | 25 | 3 | 26 |
| class_15 | 19 | 2 | 26 |
| class_16 | 15 | 1 | 26 |
| class_17 | 11 | 1 | 26 |
